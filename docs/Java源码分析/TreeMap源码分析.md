# ğŸ‘‰ TreeMapæºç åˆ†æ

## 1 çŸ¥è¯†å‚¨å¤‡

åœ¨äº†è§£ TreeMap ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ—¥å¸¸å·¥ä½œä¸­æ’åºçš„ä¸¤ç§æ–¹å¼ï¼Œä½œä¸ºæˆ‘ä»¬å­¦ä¹ çš„åŸºç¡€å‚¨å¤‡ï¼Œä¸¤ç§æ–¹å¼çš„ä»£ç å¦‚ä¸‹ï¼š

```java
public class TreeMapDemo {

  @Data
  // DTO ä¸ºæˆ‘ä»¬æ’åºçš„å¯¹è±¡
  class DTO implements Comparable<DTO> {
    private Integer id;
    public DTO(Integer id) {
      this.id = id;
    }

    @Override
    public int compareTo(DTO o) {
      //é»˜è®¤ä»å°åˆ°å¤§æ’åº
      return id - o.getId();
    }
  }

  @Test
  public void testTwoComparable() {
    // ç¬¬ä¸€ç§æ’åºï¼Œä»å°åˆ°å¤§æ’åºï¼Œå®ç° Comparable çš„ compareTo æ–¹æ³•è¿›è¡Œæ’åº
    List<DTO> list = new ArrayList<>();
    for (int i = 5; i > 0; i--) {
      list.add(new DTO(i));
    }
    Collections.sort(list);
    log.info(JSON.toJSONString(list));

    // ç¬¬äºŒç§æ’åºï¼Œä»å¤§åˆ°å°æ’åºï¼Œåˆ©ç”¨å¤–éƒ¨æ’åºå™¨ Comparator è¿›è¡Œæ’åº
    Comparator comparator = (Comparator<DTO>) (o1, o2) -> o2.getId() - o1.getId();
    List<DTO> list2 = new ArrayList<>();
    for (int i = 5; i > 0; i--) {
      list2.add(new DTO(i));
    }
    Collections.sort(list,comparator);
    log.info(JSON.toJSONString(list2));
  }
}
```

ç¬¬ä¸€ç§æ’åºè¾“å‡ºçš„ç»“æœä»å°åˆ°å¤§ï¼Œç»“æœæ˜¯ï¼š[{â€œidâ€:1},{â€œidâ€:2},{â€œidâ€:3},{â€œidâ€:4},{â€œidâ€:5}]ï¼›

ç¬¬äºŒç§è¾“å‡ºçš„ç»“æœæ°å¥½ç›¸åï¼Œç»“æœæ˜¯ï¼š[{â€œidâ€:5},{â€œidâ€:4},{â€œidâ€:3},{â€œidâ€:2},{â€œidâ€:1}]ã€‚

ä»¥ä¸Šä¸¤ç§å°±æ˜¯åˆ†åˆ«é€šè¿‡ Comparable å’Œ Comparator ä¸¤è€…è¿›è¡Œæ’åºçš„æ–¹å¼ï¼Œè€Œ TreeMap åˆ©ç”¨çš„ä¹Ÿæ˜¯æ­¤åŸç†ï¼Œä»è€Œå®ç°äº†å¯¹ key çš„æ’åºï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸‹ã€‚



## 2 TreeMap æ•´ä½“æ¶æ„

TreeMap åº•å±‚çš„æ•°æ®ç»“æ„å°±æ˜¯çº¢é»‘æ ‘ï¼Œå’Œ HashMap çš„çº¢é»‘æ ‘ç»“æ„ä¸€æ ·ã€‚

ä¸åŒçš„æ˜¯ï¼ŒTreeMap åˆ©ç”¨äº†çº¢é»‘æ ‘å·¦èŠ‚ç‚¹å°ï¼Œå³èŠ‚ç‚¹å¤§çš„æ€§è´¨ï¼Œæ ¹æ® key è¿›è¡Œæ’åºï¼Œä½¿æ¯ä¸ªå…ƒç´ èƒ½å¤Ÿæ’å…¥åˆ°çº¢é»‘æ ‘å¤§å°é€‚å½“çš„ä½ç½®ï¼Œç»´æŠ¤äº† key çš„å¤§å°å…³ç³»ï¼Œé€‚ç”¨äº key éœ€è¦æ’åºçš„åœºæ™¯ã€‚

å› ä¸ºåº•å±‚ä½¿ç”¨çš„æ˜¯å¹³è¡¡çº¢é»‘æ ‘çš„ç»“æ„ï¼Œæ‰€ä»¥ containsKeyã€getã€putã€remove ç­‰æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ log(n)ã€‚

### 2.1 å±æ€§

TreeMap å¸¸è§çš„å±æ€§æœ‰ï¼š

```java
//æ¯”è¾ƒå™¨ï¼Œå¦‚æœå¤–éƒ¨æœ‰ä¼ è¿›æ¥ Comparator æ¯”è¾ƒå™¨ï¼Œé¦–å…ˆç”¨å¤–éƒ¨çš„
//å¦‚æœå¤–éƒ¨æ¯”è¾ƒå™¨ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨ key è‡ªå·±å®ç°çš„ Comparable#compareTo æ–¹æ³•
//æ¯”è¾ƒæ‰‹æ®µå’Œä¸Šé¢æ—¥å¸¸å·¥ä½œä¸­çš„æ¯”è¾ƒ demo æ˜¯ä¸€è‡´çš„
private final Comparator<? super K> comparator;

//çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹
private transient Entry<K,V> root;

//çº¢é»‘æ ‘çš„å·²æœ‰å…ƒç´ å¤§å°
private transient int size = 0;

//æ ‘ç»“æ„å˜åŒ–çš„ç‰ˆæœ¬å·ï¼Œç”¨äºè¿­ä»£è¿‡ç¨‹ä¸­çš„å¿«é€Ÿå¤±è´¥åœºæ™¯
private transient int modCount = 0;

//çº¢é»‘æ ‘çš„èŠ‚ç‚¹
static final class Entry<K,V> implements Map.Entry<K,V> {}
```

### 2.2 æ–°å¢èŠ‚ç‚¹

æˆ‘ä»¬æ¥çœ‹ä¸‹ TreeMap æ–°å¢èŠ‚ç‚¹çš„æ­¥éª¤ï¼š

1. åˆ¤æ–­çº¢é»‘æ ‘çš„èŠ‚ç‚¹æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºçš„è¯ï¼Œæ–°å¢çš„èŠ‚ç‚¹ç›´æ¥ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼Œä»£ç å¦‚ä¸‹ï¼š

   ```java
   Entry<K,V> t = root;
   //çº¢é»‘æ ‘æ ¹èŠ‚ç‚¹ä¸ºç©ºï¼Œç›´æ¥æ–°å»º
   if (t == null) {
       // compare æ–¹æ³•é™åˆ¶äº† key ä¸èƒ½ä¸º null
       compare(key, key); // type (and possibly null) check
       // æˆä¸ºæ ¹èŠ‚ç‚¹
       root = new Entry<>(key, value, null);
       size = 1;
       modCount++;
       return null;
   }
   ```

2. æ ¹æ®çº¢é»‘æ ‘å·¦å°å³å¤§çš„ç‰¹æ€§ï¼Œè¿›è¡Œåˆ¤æ–­ï¼Œæ‰¾åˆ°åº”è¯¥æ–°å¢èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œä»£ç å¦‚ä¸‹ï¼š

   ```java
   Comparator<? super K> cpr = comparator;
   if (cpr != null) {
       //è‡ªæ—‹æ‰¾åˆ° key åº”è¯¥æ–°å¢çš„ä½ç½®ï¼Œå°±æ˜¯åº”è¯¥æŒ‚è½½é‚£ä¸ªèŠ‚ç‚¹çš„å¤´ä¸Š
       do {
           //ä¸€æ¬¡å¾ªç¯ç»“æŸæ—¶ï¼Œparent å°±æ˜¯ä¸Šæ¬¡æ¯”è¿‡çš„å¯¹è±¡
           parent = t;
           // é€šè¿‡ compare æ¥æ¯”è¾ƒ key çš„å¤§å°
           cmp = cpr.compare(key, t.key);
           //key å°äº tï¼ŒæŠŠ t å·¦è¾¹çš„å€¼èµ‹äºˆ tï¼Œå› ä¸ºçº¢é»‘æ ‘å·¦è¾¹çš„å€¼æ¯”è¾ƒå°ï¼Œå¾ªç¯å†æ¯”
           if (cmp < 0)
               t = t.left;
           //key å¤§äº tï¼ŒæŠŠ t å³è¾¹çš„å€¼èµ‹äºˆ tï¼Œå› ä¸ºçº¢é»‘æ ‘å³è¾¹çš„å€¼æ¯”è¾ƒå¤§ï¼Œå¾ªç¯å†æ¯”
           else if (cmp > 0)
               t = t.right;
           //å¦‚æœç›¸ç­‰çš„è¯ï¼Œç›´æ¥è¦†ç›–åŸå€¼
           else
               return t.setValue(value);
           // t ä¸ºç©ºï¼Œè¯´æ˜å·²ç»åˆ°å¶å­èŠ‚ç‚¹äº†
       } while (t != null);
   }
   ```

3. åœ¨çˆ¶èŠ‚ç‚¹çš„å·¦è¾¹æˆ–å³è¾¹æ’å…¥æ–°å¢èŠ‚ç‚¹ï¼Œä»£ç å¦‚ä¸‹ï¼š

   ```java
   //cmp ä»£è¡¨æœ€åä¸€æ¬¡å¯¹æ¯”çš„å¤§å°ï¼Œå°äº 0 ï¼Œä»£è¡¨ e åœ¨ä¸Šä¸€èŠ‚ç‚¹çš„å·¦è¾¹
   if (cmp < 0)
       parent.left = e;
   //cmp ä»£è¡¨æœ€åä¸€æ¬¡å¯¹æ¯”çš„å¤§å°ï¼Œå¤§äº 0 ï¼Œä»£è¡¨ e åœ¨ä¸Šä¸€èŠ‚ç‚¹çš„å³è¾¹ï¼Œç›¸ç­‰çš„æƒ…å†µç¬¬äºŒæ­¥å·²ç»å¤„ç†äº†ã€‚
   else
       parent.right = e;
   ```

4. ç€è‰²æ—‹è½¬ï¼Œè¾¾åˆ°å¹³è¡¡ï¼Œç»“æŸã€‚

ä»æºç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š

1. æ–°å¢èŠ‚ç‚¹æ—¶ï¼Œå°±æ˜¯åˆ©ç”¨äº†çº¢é»‘æ ‘å·¦å°å³å¤§çš„ç‰¹æ€§ï¼Œä»æ ¹èŠ‚ç‚¹ä¸æ–­å¾€ä¸‹æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°èŠ‚ç‚¹æ˜¯ null ä¸ºæ­¢ï¼ŒèŠ‚ç‚¹ä¸º null è¯´æ˜åˆ°è¾¾äº†å¶å­ç»“ç‚¹ï¼›
2. æŸ¥æ‰¾è¿‡ç¨‹ä¸­ï¼Œå‘ç° key å€¼å·²ç»å­˜åœ¨ï¼Œç›´æ¥è¦†ç›–ï¼›
3. TreeMap æ˜¯ç¦æ­¢ key æ˜¯ null å€¼çš„ã€‚

ç±»ä¼¼çš„ï¼ŒTreeMap æŸ¥æ‰¾ä¹Ÿæ˜¯ç±»ä¼¼çš„åŸç†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å» github ä¸Šé¢å»æŸ¥çœ‹æºç ã€‚

## 3 å°ç»“

TreeMap ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œçº¢é»‘æ ‘å’Œ HashMap æ¯”è¾ƒç±»ä¼¼ï¼Œæ¯”è¾ƒå…³é”®çš„æ˜¯é€šè¿‡ compare æ¥æ¯”è¾ƒ key çš„å¤§å°ï¼Œç„¶ååˆ©ç”¨çº¢é»‘æ ‘å·¦å°å³å¤§çš„ç‰¹æ€§ï¼Œä¸ºæ¯ä¸ª key æ‰¾åˆ°è‡ªå·±çš„ä½ç½®ï¼Œä»è€Œç»´æŠ¤äº† key çš„å¤§å°æ’åºé¡ºåºã€‚