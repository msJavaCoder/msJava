# 《MySQL必知必会》

## 1. 基础概念

### 1.1 什么是数据库

 数据库（DataBase，DB）是一个长期存储在计算机内的、有组织的、有共享的、统一管理的数据集合。它是一个按数据结构来存储和管理数据的计算机软件系统。

### 1.2 表

 在关系数据库中,表是一系列二维数组的集合，用于存储数据和操作数据的逻辑结构。表是右纵向的列和横向的行组成。行叫做记录，是组织数据的单位。列叫做字段，是记录的一个属性,所用表都是由一个或多个列组成的。

> 从技术上来说，行才是正确的术语。但是记录也不错~

我们举个例子解释，如表1-1所示：

| 编号 |  姓名  | 性别 | 年龄 |     专业     |
| :--: | :----: | :--: | :--: | :----------: |
|  1   | 张无忌 |  男  |  18  |   软件工程   |
|  2   |  赵敏  |  女  |  16  |   车辆工程   |
|  3   | 张三丰 |  男  |  99  | 文化产业管理 |

上表中，我们可以看到编码、姓名、性别、年龄、专业等就是这个表的字段（熟悉、列），编号1、2、3等从左到右一行就是这个表的记录（行）。

### 1.3 主键

主键（Primary Key），用于唯一地标识表中的每一条记录。主键列上既不能有两行相同的值，也不能为空值。

> 简单的说，主键的作用就是唯一性区分表中的每一行。

主键通常是定义在表的一列上，但是也不一定，也可以一起使用多个列最为主键，但是这多个列的组合必须满足唯一性。

### 1.4 了解SQL

SQL是对数据库进行查询和修改操作的语言，其含义是结构化查询语言（Structured Query Language）。SQL语言包含以下4部分。

1. 数据定义语言（DDL）：DROP、CREATE、ALTER等语句。
2. 数据操作语言（DML）：INSERT（插入）、UPDATE（修改）、DELETE（删除）语句。
3. 数据查询语言（DQL）：SELECT语句。
4. 数据控制语言（DCL）：GRANT、REVOKE、COMMIT、ROLLBACK等语句。

### 1.5 了解MySQL

MySQL是一个小型关系数据库管理系统。与其他大型数据库管理系统（例如Oracle、DB2、SQL Server等）相比，MySQL规模小、功能有限，但是它体积小、速度快、成本低，并且提供的功能对稍微复杂的应用来说已经够用，这些特性使得MySQL成为世界上最受欢迎的开放源代码数据库。

MySQL的优点：

1. 性能：MySQL执行很快（非常快）。
2. 成本：MySQL是开发源代码的，社区版本是免费的，企业版本是收费的。
3. 简单：MySQL安装非常简单且容易上手。
4. 移植性高：能够工作在众多不同的系统平台上，例如Windows、Linux、UNIX、Mac OS等。

MySQL常用图形管理工具推荐：

1. Navicat  下载地址：http://www.navicat.com/
2. SQLyog  下载地址：http://www.webyog.com/
3. MySQL Workbench  下载地址：http://dev.MySQL.com/downloads/workbench/

## 2. 表的基本操作

实际开发中，大多都是直接使用第三方管理软件进行数据库操作了，很少会使用命令直接操作表。但是这些基础知识也是应该了解一下的。

### 2.1 创建数据表

创建数据表的语句为`CREATE TABLE`，语法规则如下：

```sql
CREATE TABLE 表名 (
    字段名1,数据类型[列级别约束条件] [默认值] ,
    字段名2数据类型[列级别约束条件] [默认值] ,
    字段名3数据类型[列级别约束条件] [默认值] ,
    ···
    
    [表级别约束条件]
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

具体创建表的SQL如下列:

```sql
CREATE TABLE `t_student` (
  `id` int(11) NOT NULL AUTO_INCREMENT, 
  `name` varchar(32) DEFAULT NULL COMMENT '姓名',
  `sex` char(8) DEFAULT NULL COMMENT '性别',
  `age` int(11) DEFAULT NULL COMMENT '年龄',
  `major` varchar(64) DEFAULT NULL COMMENT '专业',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

注意事项：

+ 要创建的表的名称，不区分大小写，不能使用SQL语言中的关键字，如DROP、ALTER、INSERT等。
+ 数据表中每一列（字段）的名称和数据类型，如果创建多列，就要用逗号隔开。

### 2.2 查看数据表结构

查看表的结构语句，SQL命令是：SHOW  COLUMNS FROM 表名  或者  DESCRIBE  表名 或者 DESC 表名。具体操作如下：

```sql
mysql> SHOW  COLUMNS FROM t_student;
+-------+-------------+------+-----+---------+----------------+
| Field | Type        | Null | Key | Default | Extra          |
+-------+-------------+------+-----+---------+----------------+
| id    | int(11)     | NO   | PRI | NULL    | auto_increment |
| name  | varchar(32) | YES  |     | NULL    |                |
| sex   | char(8)     | YES  |     | NULL    |                |
| age   | int(11)     | YES  |     | NULL    |                |
| major | varchar(64) | YES  |     | NULL    |                |
+-------+-------------+------+-----+---------+----------------+
5 rows in set (0.00 sec)

mysql> DESCRIBE t_student;
+-------+-------------+------+-----+---------+----------------+
| Field | Type        | Null | Key | Default | Extra          |
+-------+-------------+------+-----+---------+----------------+
| id    | int(11)     | NO   | PRI | NULL    | auto_increment |
| name  | varchar(32) | YES  |     | NULL    |                |
| sex   | char(8)     | YES  |     | NULL    |                |
| age   | int(11)     | YES  |     | NULL    |                |
| major | varchar(64) | YES  |     | NULL    |                |
+-------+-------------+------+-----+---------+----------------+
5 rows in set (0.00 sec)


mysql>  DESC t_student;
+-------+-------------+------+-----+---------+----------------+
| Field | Type        | Null | Key | Default | Extra          |
+-------+-------------+------+-----+---------+----------------+
| id    | int(11)     | NO   | PRI | NULL    | auto_increment |
| name  | varchar(32) | YES  |     | NULL    |                |
| sex   | char(8)     | YES  |     | NULL    |                |
| age   | int(11)     | YES  |     | NULL    |                |
| major | varchar(64) | YES  |     | NULL    |                |
+-------+-------------+------+-----+---------+----------------+
5 rows in set (0.00 sec)

```

其中，表结构中的各个字段的含义分别解释如下：

+ NULL：表示该列是否可以存储NULL值。
+ Key：表示该列是否已编制索引。PRI表示该列是表主键的一部分；
+ UNI表示该列是UNIQUE索引的一部分；
+ MUL表示在列中某个给定值允许出现多次。
+ Default：表示该列是否有默认值，有的话指定值是多少。
+ Extra：表示可以获取的与给定列有关的附加信息，例如AUTO_INCREMENT等。

查看表创建时候的CREATE TABLE 语句，SQL命令是：`SHOW CREATE TABLE 表名`，具体操作如下：

```sql
mysql> SHOW CREATE TABLE t_student;
+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table     | Create Table                                                                                                                                                                                                                                                                                                                      |
+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| t_student | CREATE TABLE `t_student` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(32) DEFAULT NULL COMMENT '姓名',
  `sex` char(8) DEFAULT NULL COMMENT '性别',
  `age` int(11) DEFAULT NULL COMMENT '年龄',
  `major` varchar(64) DEFAULT NULL COMMENT '专业',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8         |
+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

```

> 使用SHOW CREATE TABLE语句，不仅可以查看表创建时候的详细语句，还可以查看存储引擎和字符编码。

如果不加‘\G’参数，显示的结果可能非常混乱，加上参数‘\G’之后，可使显示结果更加直观，易于查看。

使用参数‘\G’之后的结果如下：

```sql
mysql> SHOW CREATE TABLE t_student\G;
*************************** 1. row ***************************
       Table: t_student
Create Table: CREATE TABLE `t_student` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(32) DEFAULT NULL COMMENT '姓名',
  `sex` char(8) DEFAULT NULL COMMENT '性别',
  `age` int(11) DEFAULT NULL COMMENT '年龄',
  `major` varchar(64) DEFAULT NULL COMMENT '专业',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
1 row in set (0.00 sec)
```

是不是变得整洁了许多呢~ 

### 2.3 修改数据表

修改表指的是修改数据库中已经存在的数据表的结构。MySQL使用`ALTER TABLE`语句修改表。常用的修改表的操作有修改表名、修改字段数据类型或字段名、增加和删除字段、修改字段的排列位置、更改表的存储引擎、删除表的外键约束等。

修改数据表名，MySQL是通过`ALTER TABLE`语句来实现表名的修改的，具体的语法规则如下:

```sql
ALTER TABLE <旧表名称> RENAME [TO] <新表名称>;
```

其中，TO为可选参数，使用与否均不影响结果。

我们这里将上面创建的`t_student`表改为`t_students`,加个s。具体操作如下：

```sql
mysql> ALTER TABLE t_student RENAME  t_students;
Query OK, 0 rows affected (0.01 sec)
```

使用`SHOW TABLES`命令，查看当前库中的所有表。

```sql
mysql> SHOW TABLES;
+-----------------+
| Tables_in_study |
+-----------------+
| t_students      |
+-----------------+
1 row in set (0.00 sec)
```

现在表名已经修改为了`t_students`。

### 2.4 删除数据库表

删除数据表是一个危险的操作，最好在删除之前对表有个备份的心里准备。当然了，在开发中，大多数开发者不会有权限直接操作生产库中的表，所谓的“删库跑路”听听得了，真是删了库，你也跑不掉。

删除一张表的SQL命令是这样写的：`DROP TABLE [IF EXISTS]  表名`。

```sql
mysql> DROP TABLE IF EXISTS t_students;
Query OK, 0 rows affected (0.00 sec)
```

可选参数“`IF EXISTS`”用于在删除前判断删除的表是否存在，加上该参数后，再删除表的时候，如果表不存在，SQL语句可以顺利执行，但是会发出警告（warning）。

```sql
mysql> DROP TABLE IF EXISTS t_students;
Query OK, 0 rows affected, 1 warning (0.00 sec)
```

## 3. 数据类型与运算符

一张数据库表是由多个列字段组成的，每一个字段都会指定一个数据类型，数据类型也就决定了字段存储的数据内容。不同的数据类型也决定了MySQL在存储它们的时候使用的方式，以及在使用它们的时候选择什么运算符号进行运算。

MySQL数据类型：

- 数值类型：包括整数类型`TINYINT`、`SMALLINT`、`MEDIUMINT`、`INT`、`BIGINT`、浮点小数数据类型`FLOAT`和`DOUBLE`，定点小数类型`DECIMAL`。
- 日期、时间类型：包括`YEAR`、`TIME`、`DATE`、`DATETIME`和`TIMESTAMP`。
- 字符串类型：包括`CHAR`、`VARCHAR`、`BINARY`、`VARBINARY`、`BLOB`、`TEXT`、`ENUM`和`SET`等。字符串类型又分为文本字符串和二进制字符串。

### 3.1 整数类型

数值型数据类型主要用来存储数字，MySQL提供了多种数值数据类型，不同的数据类型提供不同的取值范围，可以存储的值范围越大，其所需要的存储空间也会越大。

MySQL主要提供的整数类型有`TINYINT`、`SMALLINT`、`MEDIUMINT`、`INT(INTEGER)`、`BIGINT`。整数类型的属性字段可以添加`AUTO_INCREMENT`自增约束条件。如下表MySQL中的数值类型及取值范围：

|   类型名称   |    用途    | 大小（单位：字节） |                         有符号                          |             无符号             |
| :----------: | :--------: | :----------------: | :-----------------------------------------------------: | :----------------------------: |
|   TINYINT    |  小整数值  |         1          |                       (-128，127)                       |            (0，255)            |
|   SMALLINT   |  大整数值  |         2          |                    (-32 768，32 767)                    |          (0，65 535)           |
|  MEDIUMINT   |  大整数值  |         3          |                 (-8 388 608，8 388 607)                 |        (0，16 777 215)         |
| INT(INTEGER) |  大整数值  |         4          |             -2 147 483 648，2 147 483 647)              |       (0，4 294 967 295)       |
|    BIGINT    | 极大整数值 |         8          | (-9,223,372,036,854,775,808，9 223 372 036 854 775 807) | 0，18 446 744 073 709 551 615) |

我们还以上文中创建的`t_student`表为例：

```sql
CREATE TABLE `t_student` (
  `id` int(11) NOT NULL AUTO_INCREMENT, 
  `name` varchar(32) DEFAULT NULL COMMENT '姓名',
  `sex` char(8) DEFAULT NULL COMMENT '性别',
  `age` int(11) DEFAULT NULL COMMENT '年龄',
  `major` varchar(64) DEFAULT NULL COMMENT '专业',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

id 字段的数据类型为INT(11)，注意后面的数字11，它表示的是该数据类型指定的显示宽度，即能够显示的数值中数字的个数。

显示宽度和数据类型的取值范围是无关的。显示宽度只是指明MySQL最大可能显示的数字个数，数值的位数小于指定的宽度时会由空格填充；

如果插入了大于显示宽度的值，只要该值不超过该类型整数的取值范围，数值依然可以插入，而且能够显示出来。

> 注意：显示宽度只用于显示，并不能限制取值范围和占用空间。例如：INT(3)会占用4字节的存储空间，并且允许的最大值不会是999，而是INT整型所允许的最大值。

### 3.2浮点数类型和定点数类型

| 类型名称 | 大小（单位：字节）                       | 有符号                                                       | 无符号                                                       |
| -------- | ---------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| FLOAT    | 4 bytes                                  | (-3.402 823 466 E+38，-1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402 823 466 351 E+38) | 0，(1.175 494 351 E-38，3.402 823 466 E+38)                  |
| DOUBLE   | 8 bytes                                  | (-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308) | 0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308) |
| DECIMAL  | 对DECIMAL(M,D) ，如果M>D，为M+2否则为D+2 | 依赖于M和D的值                                               | 依赖于M和D的值                                               |

### 3.3 日期与时间类型

MySQL中有多种表示日期的数据类型，主要有DATETIME、DATE、TIMESTAMP、TIME和YEAR。

|  类名称   | 大小（单位：字节） |                             范围                             | 格式                |           用途           |
| :-------: | :----------------: | :----------------------------------------------------------: | :------------------ | :----------------------: |
|   DATE    |         3          |                    1000-01-01/9999-12-31                     | YYYY-MM-DD          |          日期值          |
|   TIME    |         3          |                   '-838:59:59'/'838:59:59'                   | HH:MM:SS            |     时间值或持续时间     |
|   YEAR    |         1          |                          1901/2155                           | YYYY                |          年份值          |
| DATETIME  |         8          |           1000-01-01 00:00:00/9999-12-31 23:59:59            | YYYY-MM-DD HH:MM:SS |     混合日期和时间值     |
| TIMESTAMP |         4          | 1970-01-01 00:00:00/2038结束时间是第 2147483647 秒，北京时间 2038-1-19 11:14:07 | YYYYMMDD HHMMSS     | 混合日期和时间值，时间戳 |

### 3.4 如何选择数据类型

MySQL中提供了很多的数据类型供选择，选择最合适的数据类型，有利于优化存储、提供数据库性能。在上文中我们对MySQL中的数据类型逐一做了介绍，在此基础上我们进一步分析，在实际使用过程中，我们该如何选择数据类型才能尽可能最优、最合适。

#### 3.4.1 整数和浮点数

整数类型使用非常频繁，如果你确定你不需要小数部分的话，可以选择整数类型来保存数据。如果你需要小数部分，可以选择浮点数类型，浮点数类型存入的数据会对该列定义的小数位进行四舍五入。

浮点类型包括`FLOAT`和`DOUBLE`类型。`DOUBLE`类型精度比`FLOAT`类型高，因此要求存储精度较高时应选择`DOUBLE`类型。

还有一点，如果你定义货币等这类对精确度要求较高的数据时候，可以选择`DECIMAL`。

#### 3.4.2 日期与时间类型

MySQL中有不同种类的日期和时间的数据类型，比如`YEAR`和`TIME`。如果仅需要记录年份，则使用`YEAR`类型即可；如果仅记录时间，则使用`TIME`类型。

如果同时需要记录日期和时间的话，则可以使用`TIMESTAMP`或者`DATETIME`类型。由于`TIMESTAMP`列的取值范围小于`DATETIME`的取值范围，因此存储范围较大的日期最好使用`DATETIME`。

`TIMESTAMP`也有一个`DATETIME`不具备的属性。默认的情况下，当插入一条记录但并没有指定`TIMESTAMP`这个列值时，MySQL会把`TIMESTAMP`列设为当前的时间，这一点非常方便。

因此当需要插入记录的同时插入当前时间时，使用`IMESTAMP`是方便的。另外，`TIMESTAMP`在空间上比`DATETIME`更有效。

#### 3.4.3 CHAR与VARCHAR之间的特点与选择

我们先看看`CHAR`与`VARCHAR`的区别：

- `CHAR`是固定长度字符，`VARCHAR`是可变长度字符；
- `CHAR`会自动删除插入数据的尾部空格，`VARCHAR`不会删除尾部空格；

因为`CHAR`是固定长度，所以它的处理速度会比`VARCHAR`的速度快，但是缺点也很明显，那就是造成一定程度上的存储空间浪费，对于那些存储不大但是速度有要求的可以选择使用`CHAR`类型，反之可以使用`VARCHAR`类型。

我们来看看存储引擎对于选择`CHAR`和`VARCHAR`会产生什么影响：

+ `MyISAM`：最好使用固定长度的数据列代替可变长度的数据列。这样可以使整个表静态化，从而使数据检索更快，用空间换时间。
+ `InnoDB`：使用可变长度的数据列，因为`InnoDB`数据表的存储格式不分固定长度和可变长度，因此使用`CHAR`不一定比使用`VARCHAR`更好，但由于`VARCHAR`是按照实际的长度存储的，比较节省空间，所以对磁盘I/O和数据存储总量比较好。

#### 3.4.4 ENUM和SET

`ENUM`只能取单值，它的数据列表是一个枚举集合。它的合法取值列表最多允许有65535个成员。因此，在需要从多个值中选取一个时，可以使用`ENUM`。比如：性别字段适合定义为`ENUM`类型，每次只能从‘男’或‘女’中取一个值。

`SET`可取多值。它的合法取值列表最多允许有64个成员。空字符串也是一个合法的`SET`值。在需要取多个值的时候，适合使用`SET`类型，比如要存储一个人的兴趣爱好，最好使用SET类型。

`ENUM`和`SET`的值是以字符串形式出现的，但在内部，MySQL是以数值的形式存储它们的。

#### 3.4.5 BLOB和TEXT

`BLOB`是二进制字符串，`TEXT`是非二进制字符串，两者均可存放大容量的信息。`BLOB`主要存储图片、音频信息等，而`TEXT`只能存储纯文本文件。

## 4. 查询数据

### 4.1 单表查询

#### 4.1.1 查询所有字段

















